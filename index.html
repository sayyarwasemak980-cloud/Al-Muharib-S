<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³: Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

        body {
            margin: 0; padding: 0; overflow: hidden;
            font-family: 'Cairo', sans-serif;
            background-color: #000; color: white;
            user-select: none; -webkit-user-select: none;
            touch-action: manipulation;
        }

        #game-container {
            position: relative; width: 100vw; height: 100vh;
            overflow: hidden;
        }

        /* HUD Info */
        #hud {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0, 0, 0, 0.8); padding: 10px 20px;
            border-radius: 15px; border: 2px solid #ffd700;
            font-size: 1.1rem; z-index: 1000; display: none;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .scene {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; display: none;
            flex-direction: column; justify-content: center;
            align-items: center; text-align: center;
        }

        .active { display: flex; }

        .full-screen-media { 
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; object-fit: cover; 
            z-index: 1;
        }

        /* Fallback background if image fails */
        .img-fallback {
            background-color: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 5rem;
        }
        
        .content-overlay {
            position: relative; z-index: 10;
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: rgba(0,0,0,0.3);
        }

        .btn {
            background: linear-gradient(45deg, #ff9800, #ff5722);
            color: white; border: 2px solid white;
            padding: 15px 40px; font-size: 1.5rem;
            cursor: pointer; border-radius: 50px;
            z-index: 100; margin-top: 20px;
            transition: transform 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .btn:active { transform: scale(0.9); }

        /* Game Elements */
        .wbc { 
            width: 60px; height: 60px; background: rgba(255,255,255,0.9); 
            border-radius: 50%; box-shadow: 0 0 20px #fff;
            display: flex; justify-content: center; align-items: center; 
            position: absolute; cursor: pointer; font-size: 30px; z-index: 50;
        }
        .bomb { 
            width: 60px; height: 60px; background: #000; 
            border-radius: 50%; border: 3px solid red; 
            position: absolute; cursor: pointer;
            display: flex; justify-content: center; align-items: center; z-index: 50;
        }

        /* Boss Battle UI */
        #boss-ui {
            position: absolute; top: 10px; right: 10px;
            font-size: 1.2rem; background: rgba(255,0,0,0.7);
            padding: 10px; border-radius: 10px; border: 2px solid white;
            z-index: 1001;
        }

        #fort-grid { 
            display: grid; grid-template-columns: repeat(5, 60px); 
            gap: 10px; margin-top: 20px; position: relative; z-index: 20;
        }

        /* Typing Effect */
        #typewriter-text { 
            font-size: 2rem; line-height: 1.6; 
            color: #ffd700; text-shadow: 0 0 10px #000;
            max-width: 80%; z-index: 20;
        }

        .heart-icon { 
            color: red; font-size: 5rem; display: block; 
            margin-top: 20px; animation: pulse 1s infinite; 
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Fire Background for Gameplay */
        .fire-bg {
            background: linear-gradient(to top, #4b0000, #ff4500, #000);
            animation: flicker 3s infinite alternate;
        }
        @keyframes flicker {
            0% { opacity: 0.85; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>

    <!-- Audio Assets - ØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø·Ø§Ø¨Ù‚Ø© Ø£Ø³Ù…Ø§Ø¡ Ù…Ù„ÙØ§ØªÙƒ -->
    <audio id="bg-music" loop preload="auto"><source src="sound 1.mp3" type="audio/mpeg"></audio>
    <audio id="click-sound" preload="auto"><source src="sound 2.mp3" type="audio/mpeg"></audio>
    <audio id="typing-sound" loop preload="auto"><source src="sound 2.mp3" type="audio/mpeg"></audio>

    <div id="game-container">
        <div id="hud">ğŸ›¡ï¸ Ø§Ù„Ù…Ù†Ø§Ø¹Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©: <span id="ammo-count">0</span></div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 1: Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div id="scene-start" class="scene active">
            <!-- Ø¥Ø°Ø§ Ù„Ù… ØªØ¸Ù‡Ø± Ø§Ù„ØµÙˆØ±Ø© Ø³ÙŠØ¸Ù‡Ø± Ø±Ù…Ø² Ø§Ù„Ø¯Ø±Ø¹ ÙƒØ®Ù„ÙÙŠØ© -->
            <div class="full-screen-media img-fallback">ğŸ›¡ï¸</div>
            <img src="ÙˆØ§Ø¬Ù‡Ø©.png" class="full-screen-media" alt="">
            <div class="content-overlay">
                <h1 style="font-size: 3.5rem; color: #ffd700; text-shadow: 2px 2px 10px #000;">Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³</h1>
                <button class="btn" onclick="startGame()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø£Ø­Ù…Ø±</button>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 2: ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚Ø© (First.mp4) -->
        <div id="scene-video-intro" class="scene">
            <video id="vid-intro" class="full-screen-media" onended="endVideoIntro()">
                <source src="First.mp4" type="video/mp4">
            </video>
        </div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 3: Ù‚ØµØ© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ -->
        <div id="scene-story" class="scene">
            <div class="full-screen-media img-fallback">ğŸ“–</div>
            <img src="Ù‚ØµØ© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³.png" class="full-screen-media" alt="">
            <div class="content-overlay">
                <button class="btn" style="position:absolute; bottom:40px" onclick="playLevelIntro(1)">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 4: Ù…Ù‚Ø¯Ù…Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø© -->
        <div id="scene-level-intro" class="scene">
            <video id="level-intro-video" class="full-screen-media" onended="startActualGameplay()">
                <source src="" type="video/mp4">
            </video>
            <div id="skip-intro" style="position:absolute; bottom:20px; left:20px; z-index:100; cursor:pointer; background:rgba(0,0,0,0.7); padding:8px 20px; border-radius:20px; border:1px solid #fff;" onclick="startActualGameplay()">ØªØ®Ø·ÙŠ Ø§Ù„Ø¹Ø±Ø¶ >></div>
        </div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 5: Ø³Ø§Ø­Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„ÙØ¹Ù„ÙŠØ© -->
        <div id="scene-gameplay" class="scene fire-bg">
            <div id="level-announcement" style="font-size:3rem; color:gold; z-index:100; text-shadow: 0 0 15px #000;">Ø§Ù„Ù…Ø±Ø­Ù„Ø© <span id="lvl-num">1</span></div>
        </div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 6: Ø­ØµÙ† Ø§Ù„ØªÙ†ÙŠÙ† -->
        <div id="scene-boss" class="scene">
            <div id="boss-ui">â±ï¸ Ø§Ù„ÙˆÙ‚Øª: <span id="boss-timer">120</span></div>
            <div class="content-overlay">
                <h2 style="color:red; background:rgba(0,0,0,0.7); padding:10px; border-radius:10px;">Ø¯Ù…Ø± Ø­ØµÙ† Ø§Ù„ØªÙ†ÙŠÙ† Ù‚Ø¨Ù„ ÙÙˆØ§Øª Ø§Ù„Ø£ÙˆØ§Ù†!</h2>
                <div id="fort-grid"></div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 7: Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© -->
        <div id="scene-truth" class="scene">
            <div class="full-screen-media img-fallback">ğŸ’¡</div>
            <img src="Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³.png" class="full-screen-media" alt="">
        </div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 8: Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®ØªØ§Ù…ÙŠØ© -->
        <div id="scene-message" class="scene" style="background: #000;">
            <div id="typewriter-text"></div>
        </div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 9: ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
        <div id="scene-win-video" class="scene">
            <video id="vid-win" class="full-screen-media">
                <source src="win.mp4" type="video/mp4">
            </video>
        </div>

        <!-- Ø§Ù„Ù…Ø´Ù‡Ø¯ 10: Ø§Ù„Ø®Ø³Ø§Ø±Ø© -->
        <div id="scene-lose" class="scene">
            <div class="content-overlay">
                <h1 style="font-size: 3rem; color: red;">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©!</h1>
                <button class="btn" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙƒØ±Ø©</button>
            </div>
        </div>
    </div>

    <script>
        const state = { 
            ammo: 0, 
            level: 1, 
            bossTimer: 120, 
            intervals: [],
            isGameOver: false 
        };

        // ÙˆØ¸ÙŠÙØ© ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø·Ø£ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function playSfx(id, loop = false) {
            const s = document.getElementById(id);
            if (s) { 
                s.loop = loop; 
                s.currentTime = 0; 
                s.play().catch(e => console.log("Audio play blocked: ", e)); 
            }
        }

        function stopSfx(id) {
            const s = document.getElementById(id);
            if (s) s.pause();
        }

        function switchScene(id) {
            document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startGame() {
            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø¶ØºØ·Ø© Ø²Ø± Ù„ØªØ¬Ù†Ø¨ Ø­Ø¸Ø± Ø§Ù„Ù…ØªØµÙØ­
            playSfx('bg-music', true);
            switchScene('scene-video-intro');
            const v = document.getElementById('vid-intro');
            v.play().catch(() => endVideoIntro());
        }

        function endVideoIntro() {
            switchScene('scene-story');
        }

        function playLevelIntro(num) {
            state.level = num;
            document.getElementById('hud').style.display = 'none';
            
            const introVideo = document.getElementById('level-intro-video');
            introVideo.src = `level ${num}.mp4`;
            switchScene('scene-level-intro');
            introVideo.play().catch(() => {
                startActualGameplay();
            });
        }

        function startActualGameplay() {
            const v = document.getElementById('level-intro-video');
            v.pause();
            document.getElementById('hud').style.display = 'block';
            document.getElementById('lvl-num').innerText = state.level;
            switchScene('scene-gameplay');
            
            const stageTimer = setInterval(spawnItem, 800);
            state.intervals.push(stageTimer);
            
            setTimeout(() => {
                clearInterval(stageTimer);
                if(state.level < 3) {
                    playLevelIntro(state.level + 1);
                } else {
                    startBossBattle();
                }
            }, 15000); 
        }

        function spawnItem() {
            const container = document.getElementById('scene-gameplay');
            if(!container.classList.contains('active')) return;

            const isBomb = Math.random() > 0.8;
            const item = document.createElement('div');
            item.className = isBomb ? 'bomb' : 'wbc';
            item.style.left = (Math.random() * 80 + 10) + 'vw';
            item.style.top = '-70px';
            item.innerText = isBomb ? 'ğŸ’£' : 'ğŸ›¡ï¸';
            container.appendChild(item);

            let top = -70;
            const anim = setInterval(() => {
                top += 7;
                item.style.top = top + 'px';
                if(top > window.innerHeight) { 
                    clearInterval(anim); 
                    item.remove(); 
                }
            }, 20);

            item.onclick = (e) => {
                e.stopPropagation();
                playSfx('click-sound');
                state.ammo += isBomb ? -10 : 3;
                if(state.ammo < 0) state.ammo = 0;
                document.getElementById('ammo-count').innerText = state.ammo;
                item.remove();
                clearInterval(anim);
            };
        }

        function startBossBattle() {
            switchScene('scene-boss');
            const grid = document.getElementById('fort-grid');
            grid.innerHTML = '';
            for(let i=0; i<20; i++) {
                const brick = document.createElement('div');
                brick.style = "width:60px; height:40px; background:darkred; border:2px solid gold; cursor:pointer; display:flex; justify-content:center; align-items:center;";
                brick.innerText = "ğŸ§±";
                brick.onclick = (e) => {
                    e.stopPropagation();
                    if(state.ammo > 0) {
                        playSfx('click-sound');
                        state.ammo--; 
                        document.getElementById('ammo-count').innerText = state.ammo;
                        brick.style.visibility = 'hidden';
                        checkBossWin();
                    }
                };
                grid.appendChild(brick);
            }

            const timerInt = setInterval(() => {
                if(state.isGameOver) return;
                state.bossTimer--;
                document.getElementById('boss-timer').innerText = state.bossTimer;
                if(state.bossTimer <= 0) gameOver();
            }, 1000);
            state.intervals.push(timerInt);
        }

        function checkBossWin() {
            const remaining = Array.from(document.getElementById('fort-grid').children).filter(b => b.style.visibility !== 'hidden');
            if(remaining.length === 0) {
                state.intervals.forEach(clearInterval);
                showTruth();
            }
        }

        function gameOver() {
            state.isGameOver = true;
            state.intervals.forEach(clearInterval);
            document.getElementById('hud').style.display = 'none';
            switchScene('scene-lose');
        }

        function showTruth() {
            document.getElementById('hud').style.display = 'none';
            switchScene('scene-truth');
            setTimeout(() => {
                switchScene('scene-message');
                startFinalTypewriter();
            }, 6000);
        }

        function startFinalTypewriter() {
            const text = "Ù…Ù† Ø§Ù„Ù‚Ù„Ø¨ Ø¥Ù„Ù‰ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø¹Ø§Ù„Ù…: Ø¹ÙØ´ØªÙ… Ø£ØµØ­Ø§Ø¡ØŒ Ù…ØªÙØ§Ø¦Ù„ÙŠÙ†ØŒ Ø¢Ù…Ù†ÙŠÙ†";
            const target = document.getElementById('typewriter-text');
            let i = 0;
            playSfx('typing-sound', true);

            function type() {
                if(i < text.length) {
                    target.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, 120);
                } else {
                    stopSfx('typing-sound');
                    target.innerHTML += '<span class="heart-icon">â¤ï¸</span>';
                    setTimeout(() => {
                        switchScene('scene-win-video');
                        const wv = document.getElementById('vid-win');
                        if(wv) wv.play();
                    }, 5000);
                }
            }
            type();
        }
    </script>
</body>
</html>
