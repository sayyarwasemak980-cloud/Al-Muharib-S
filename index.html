<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³: Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø£Ø­Ù…Ø±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

        body {
            margin: 0; padding: 0; overflow: hidden;
            font-family: 'Cairo', sans-serif;
            background-color: #000; color: white;
            user-select: none; -webkit-user-select: none;
            touch-action: manipulation;
        }

        #game-container {
            position: relative; width: 100vw; height: 100vh;
            overflow: hidden;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†ÙŠØ±Ø§Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ø© Ù„Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„Ù‰ */
        .fire-stage {
            background: linear-gradient(to top, #800000, #ff4500, #200000);
            animation: flicker 2s infinite alternate;
        }

        @keyframes flicker {
            0% { filter: brightness(1); }
            100% { filter: brightness(1.3); }
        }

        #hud {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0, 0, 0, 0.7); padding: 10px 20px;
            border-radius: 15px; border: 2px solid #fff;
            font-size: 1.2rem; z-index: 1000; display: none;
            box-shadow: 0 0 15px #ff4500;
        }

        .scene {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; display: none;
            flex-direction: column; justify-content: center;
            align-items: center; text-align: center;
        }

        .active { display: flex; opacity: 1; }

        .full-screen-media { width: 100%; height: 100%; object-fit: cover; }
        
        .btn {
            background: linear-gradient(45deg, #ff9800, #ff5722);
            color: white; border: 2px solid white;
            padding: 15px 40px; font-size: 1.5rem;
            cursor: pointer; border-radius: 50px;
            z-index: 10; margin-top: 20px;
        }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù„Ø¹Ø¨ */
        .wbc { 
            width: 65px; height: 65px; background: #fff; 
            border-radius: 50%; box-shadow: 0 0 15px #fff;
            display: flex; justify-content: center; align-items: center; color: #333;
            position: absolute; cursor: pointer;
        }
        .bomb { 
            width: 55px; height: 55px; background: #000; 
            border-radius: 50%; border: 3px solid red; 
            position: absolute; cursor: pointer;
        }
        .bomb::after { content: 'ğŸ’£'; font-size: 24px; }

        /* Ø­ØµÙ† Ø§Ù„ØªÙ†ÙŠÙ† */
        #boss-ui {
            position: absolute; top: 10px; right: 10px;
            font-size: 1.5rem; background: rgba(255,0,0,0.5);
            padding: 10px; border-radius: 10px; border: 2px solid white;
            z-index: 1001;
        }

        #fort-grid { display: grid; grid-template-columns: repeat(5, 60px); gap: 10px; margin-top: 20px; }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙˆØ§Ù„Ù‚Ù„Ø¨ */
        #typewriter-text { 
            font-size: 2.2rem; line-height: 1.8; 
            white-space: pre-wrap; color: #ffd700;
            text-shadow: 0 0 10px #ff4500;
        }
        .heart-icon { 
            color: red; font-size: 4rem; display: block; 
            margin-top: 20px; animation: pulse 1s infinite; 
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        #scene-lose { background: #300; }
    </style>
</head>
<body>

    <!-- Ù…ØµØ§Ø¯Ø± Ø§Ù„ØµÙˆØªÙŠØ§Øª -->
    <audio id="bg-music" loop><source src="Sound 1.mp3" type="audio/mpeg"></audio>
    <audio id="click-sound"><source src="sound 2.mp3" type="audio/mpeg"></audio>
    <audio id="typing-sound" loop><source src="sound 2.mp3" type="audio/mpeg"></audio>

    <div id="game-container">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
        <div id="hud">
            ğŸ›¡ï¸ Ø°Ø®ÙŠØ±Ø© Ø§Ù„Ù…Ù†Ø§Ø¹Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ©: <span id="ammo-count">0</span>
        </div>

        <!-- Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ -->
        <div id="scene-start" class="scene active">
            <img src="ÙˆØ§Ø¬Ù‡Ø©.png" alt="ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©" class="full-screen-media">
            <button class="btn" style="position: absolute; bottom: 50px;" onclick="startGame()">Ø§Ù„Ø¨Ø¯Ø¡</button>
        </div>

        <div id="scene-video-intro" class="scene">
            <video id="vid-intro" class="full-screen-media" onended="endVideo('scene-story')">
                <source src="First.mp4" type="video/mp4">
            </video>
        </div>

        <div id="scene-story" class="scene">
            <img src="Ù‚ØµØ© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³.png" class="full-screen-media">
        </div>

        <div id="scene-gameplay" class="scene fire-stage"></div>

        <div id="scene-boss" class="scene" style="background: #200;">
            <div id="boss-ui">â±ï¸ Ø§Ù„ÙˆÙ‚Øª: <span id="boss-timer">120</span></div>
            <h1 style="color: red; text-shadow: 0 0 10px #000;">Ø­ØµÙ† Ø§Ù„ØªÙ†ÙŠÙ†</h1>
            <div id="fort-grid"></div>
        </div>

        <div id="scene-truth" class="scene">
            <img src="Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³.png" class="full-screen-media">
        </div>

        <div id="scene-message" class="scene" style="background: black; padding: 40px;">
            <div id="typewriter-text"></div>
        </div>

        <div id="scene-end-video" class="scene">
            <video id="vid-end" class="full-screen-media">
                <source src="End.mp4" type="video/mp4">
            </video>
        </div>

        <div id="scene-lose" class="scene">
            <h1 style="font-size: 3rem; color: red;">Ø§Ù†Ù‡Ø§Ø± Ø§Ù„Ø­ØµÙ†!</h1>
            <p>Ù†ÙØ¯ Ø§Ù„ÙˆÙ‚Øª Ø£Ùˆ Ø§Ù„Ø°Ø®ÙŠØ±Ø©.. Ø§Ù„ØªÙ†ÙŠÙ† Ø§Ù†ØªØµØ± Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©.</p>
            <button class="btn" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
        </div>
    </div>

    <script>
        const state = { 
            ammo: 0, 
            level: 1, 
            bossTimer: 120, 
            intervals: [],
            isGameOver: false 
        };

        function playSfx(id, loop = false) {
            const s = document.getElementById(id);
            if (s) {
                s.loop = loop;
                s.currentTime = 0;
                s.play().catch(() => {});
            }
        }

        function stopSfx(id) {
            const s = document.getElementById(id);
            if (s) s.pause();
        }

        function switchScene(id) {
            document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startGame() {
            playSfx('bg-music');
            switchScene('scene-video-intro');
            document.getElementById('vid-intro').play();
        }

        function endVideo(next) {
            switchScene(next);
            if(next === 'scene-story') {
                setTimeout(() => startLevel(1), 7000);
            }
        }

        function startLevel(num) {
            state.level = num;
            document.getElementById('hud').style.display = 'block';
            switchScene('scene-gameplay');
            
            const stageTimer = setInterval(spawnItem, 800);
            state.intervals.push(stageTimer);
            
            setTimeout(() => {
                clearInterval(stageTimer);
                if(state.level < 3) startLevel(state.level + 1);
                else startBossBattle();
            }, 20000); 
        }

        function spawnItem() {
            const container = document.getElementById('scene-gameplay');
            const isBomb = Math.random() > 0.8;
            const item = document.createElement('div');
            item.className = isBomb ? 'bomb' : 'wbc';
            item.style.left = Math.random() * 85 + 'vw';
            item.style.top = '-70px';
            container.appendChild(item);

            let top = -70;
            const anim = setInterval(() => {
                top += 6;
                item.style.top = top + 'px';
                if(top > window.innerHeight) { clearInterval(anim); item.remove(); }
            }, 20);

            item.onclick = () => {
                playSfx('click-sound');
                state.ammo += isBomb ? -15 : 2;
                if(state.ammo < 0) state.ammo = 0;
                document.getElementById('ammo-count').innerText = state.ammo;
                item.remove();
                clearInterval(anim);
            };
        }

        function startBossBattle() {
            switchScene('scene-boss');
            const grid = document.getElementById('fort-grid');
            grid.innerHTML = '';
            for(let i=0; i<20; i++) {
                const brick = document.createElement('div');
                brick.style = "width:60px; height:40px; background:darkred; border:2px solid gold; cursor:pointer;";
                brick.onclick = () => {
                    if(state.ammo > 0) {
                        playSfx('click-sound');
                        state.ammo--; 
                        document.getElementById('ammo-count').innerText = state.ammo;
                        brick.style.visibility = 'hidden';
                        brick.style.pointerEvents = 'none';
                        checkBossWin();
                    } else {
                        gameOver();
                    }
                };
                grid.appendChild(brick);
            }

            const timerInt = setInterval(() => {
                if(state.isGameOver) return;
                state.bossTimer--;
                document.getElementById('boss-timer').innerText = state.bossTimer;
                if(state.bossTimer <= 0) gameOver();
            }, 1000);
            state.intervals.push(timerInt);
        }

        function checkBossWin() {
            const remaining = Array.from(document.getElementById('fort-grid').children).filter(b => b.style.visibility !== 'hidden');
            if(remaining.length === 0) {
                state.intervals.forEach(clearInterval);
                showTruth();
            }
        }

        function gameOver() {
            state.isGameOver = true;
            state.intervals.forEach(clearInterval);
            document.getElementById('hud').style.display = 'none';
            switchScene('scene-lose');
        }

        function showTruth() {
            document.getElementById('hud').style.display = 'none';
            switchScene('scene-truth');
            setTimeout(() => {
                switchScene('scene-message');
                startFinalTypewriter();
            }, 7000);
        }

        function startFinalTypewriter() {
            const text = "Ù…Ù† Ø§Ù„Ù‚Ù„Ø¨ Ø¥Ù„Ù‰ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø¹Ø§Ù„Ù…: Ø¹ÙØ´ØªÙ… Ø£ØµØ­Ø§Ø¡ØŒ Ù…ØªÙØ§Ø¦Ù„ÙŠÙ†ØŒ Ø¢Ù…Ù†ÙŠÙ†";
            const target = document.getElementById('typewriter-text');
            let i = 0;
            
            playSfx('typing-sound', true);

            function type() {
                if(i < text.length) {
                    target.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, 120);
                } else {
                    stopSfx('typing-sound');
                    target.innerHTML += '<span class="heart-icon">â¤ï¸</span>';
                    
                    setTimeout(() => {
                        switchScene('scene-end-video');
                        document.getElementById('vid-end').play();
                    }, 5000);
                }
            }
            type();
        }
    </script>
</body>
</html>