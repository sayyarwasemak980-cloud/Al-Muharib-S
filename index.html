<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³: Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

        body {
            margin: 0; padding: 0; overflow: hidden;
            font-family: 'Cairo', sans-serif;
            background-color: #000; color: white;
            user-select: none; -webkit-user-select: none;
            touch-action: manipulation;
        }

        #game-container {
            position: relative; width: 100vw; height: 100vh;
            overflow: hidden;
            background: #000;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ù†Ø§Ø¹Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ© Ø§Ù„Ù…Ø¹Ø¯Ù„ */
        #hud {
            position: absolute; top: 20px; right: 20px;
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(50,50,50,0.8));
            padding: 15px 25px;
            border-radius: 50px; border: 3px solid #ffd700;
            font-size: 1.4rem; z-index: 2000; display: none;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            font-weight: bold;
            color: #ffd700;
        }

        .scene {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; display: none;
            flex-direction: column; justify-content: center;
            align-items: center; text-align: center;
        }

        .active { display: flex; }

        .full-screen-media { 
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; object-fit: cover; 
            z-index: 1;
        }

        .content-overlay {
            position: relative; z-index: 10;
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: rgba(0,0,0,0.4);
        }

        .btn {
            background: linear-gradient(45deg, #ff9800, #ff5722);
            color: white; border: 3px solid white;
            padding: 18px 45px; font-size: 1.6rem;
            cursor: pointer; border-radius: 50px;
            z-index: 100; margin-top: 20px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 87, 34, 0.4);
            font-weight: bold;
        }

        .btn:hover { transform: scale(1.05); box-shadow: 0 0 25px #ff5722; }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø¹Ø© Ø§Ù„Ù…ØªØ³Ø§Ù‚Ø·Ø© */
        .wbc { 
            width: 70px; height: 70px; 
            background: radial-gradient(circle, #fff, #ffd700); 
            border-radius: 50%; box-shadow: 0 0 30px #ffd700;
            display: flex; justify-content: center; align-items: center; 
            position: absolute; cursor: pointer; font-size: 35px; z-index: 500;
            border: 2px solid #fff;
        }
        
        .bomb { 
            width: 70px; height: 70px; background: #222; 
            border-radius: 50%; border: 4px solid #ff0000; 
            position: absolute; cursor: pointer;
            display: flex; justify-content: center; align-items: center; 
            z-index: 500; font-size: 35px;
            box-shadow: 0 0 20px #ff0000;
        }

        /* Boss Scene UI */
        #boss-timer-container {
            position: absolute; top: 20px; left: 20px;
            font-size: 1.5rem; background: rgba(255,0,0,0.8);
            padding: 15px; border-radius: 15px; border: 2px solid white;
            z-index: 2000; color: white; font-weight: bold;
        }

        #fort-grid { 
            display: grid; grid-template-columns: repeat(5, 70px); 
            gap: 15px; margin-top: 30px; position: relative; z-index: 100;
        }

        /* Typing & Ending */
        #typewriter-text { 
            font-size: 2.2rem; line-height: 1.8; 
            color: #ffd700; text-shadow: 0 0 15px #000;
            max-width: 85%; z-index: 100; font-weight: bold;
        }

        /* Backgrounds */
        .game-field {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('level 1.mp4'); /* Will be set via JS */
            background-size: cover;
            background-color: #111;
        }

        #skip-intro {
            position: absolute; bottom: 30px; left: 30px; z-index: 1000;
            background: rgba(0,0,0,0.8); color: white; padding: 10px 25px;
            border-radius: 30px; border: 2px solid #ffd700; cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <!-- Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØª -->
    <audio id="bg-music" loop><source src="sound 1.mp3" type="audio/mpeg"></audio>
    <audio id="click-sound"><source src="sound 2.mp3" type="audio/mpeg"></audio>
    <audio id="typing-sound" loop><source src="sound 2.mp3" type="audio/mpeg"></audio>

    <div id="game-container">
        <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù†Ø§Ø¹Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
        <div id="hud">ğŸ›¡ï¸ Ø§Ù„Ù…Ù†Ø§Ø¹Ø©: <span id="ammo-count">0</span></div>

        <!-- 1. Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div id="scene-start" class="scene active">
            <img src="ÙˆØ§Ø¬Ù‡Ø©.png" class="full-screen-media" onerror="this.parentElement.style.background='#111'">
            <div class="content-overlay">
                <h1 style="font-size: 4rem; color: #ffd700; text-shadow: 4px 4px 15px #000; margin:0;">Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³</h1>
                <p style="font-size: 1.5rem; color: #fff; margin-bottom: 20px;">Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ© Ø§Ù„ÙƒØ¨Ø±Ù‰</p>
                <button class="btn" onclick="startGame()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø£Ø­Ù…Ø±</button>
            </div>
        </div>

        <!-- 2. ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚Ø© (First.mp4) -->
        <div id="scene-video-intro" class="scene">
            <video id="vid-intro" class="full-screen-media" onended="goToStory()">
                <source src="First.mp4" type="video/mp4">
            </video>
            <div id="skip-intro" onclick="goToStory()">ØªØ®Ø·ÙŠ Ø§Ù„Ø¹Ø±Ø¶ >></div>
        </div>

        <!-- 3. Ù‚ØµØ© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³ -->
        <div id="scene-story" class="scene">
            <img src="Ù‚ØµØ© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³.png" class="full-screen-media">
            <div class="content-overlay">
                <button class="btn" style="position:absolute; bottom:50px" onclick="playLevelIntro(1)">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©</button>
            </div>
        </div>

        <!-- 4. ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ù‚Ø¯Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ -->
        <div id="scene-level-intro" class="scene">
            <video id="level-intro-video" class="full-screen-media" onended="startActualLevel()">
                <source src="" type="video/mp4">
            </video>
            <div id="skip-intro" onclick="startActualLevel()">ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© >></div>
        </div>

        <!-- 5. Ø³Ø§Ø­Ø© Ø§Ù„Ù„Ø¹Ø¨ (Ø§Ù„Ù…Ø±Ø§Ø­Ù„) -->
        <div id="scene-gameplay" class="scene game-field">
            <div id="stage-announcer" style="font-size:4rem; color:#ffd700; z-index:100; text-shadow: 0 0 20px #000;">Ø§Ù„Ù…Ø±Ø­Ù„Ø© <span id="current-lvl-text">1</span></div>
        </div>

        <!-- 6. Ø­ØµÙ† Ø§Ù„ØªÙ†ÙŠÙ† (Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©) -->
        <div id="scene-boss" class="scene">
            <video class="full-screen-media" autoplay muted loop><source src="level 3.mp4" type="video/mp4"></video>
            <div id="boss-timer-container">â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="boss-timer">60</span> Ø«Ø§Ù†ÙŠØ©</div>
            <div class="content-overlay">
                <h2 style="color:#ffd700; font-size:2.5rem; text-shadow: 0 0 10px #000; margin-bottom:10px;">Ø¯Ù…Ø± Ø­ØµÙ† Ø§Ù„ØªÙ†ÙŠÙ† Ø¨Ø§Ù„Ø°Ø®ÙŠØ±Ø© Ø§Ù„ØªÙŠ Ø¬Ù…Ø¹ØªÙ‡Ø§!</h2>
                <div id="fort-grid"></div>
            </div>
        </div>

        <!-- 7. Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© -->
        <div id="scene-truth" class="scene">
            <img src="Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ Ø³.png" class="full-screen-media">
        </div>

        <!-- 8. Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®ØªØ§Ù…ÙŠØ© (Typewriter) -->
        <div id="scene-message" class="scene" style="background: #000;">
            <div id="typewriter-text"></div>
        </div>

        <!-- 9. ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (win.mp4) -->
        <div id="scene-win-video" class="scene">
            <video id="vid-win" class="full-screen-media">
                <source src="win.mp4" type="video/mp4">
            </video>
        </div>

        <!-- 10. Ø§Ù„Ø®Ø³Ø§Ø±Ø© -->
        <div id="scene-lose" class="scene">
            <div class="content-overlay">
                <h1 style="font-size: 4rem; color: red; text-shadow: 0 0 20px #000;">Ø§Ù†ØªÙ‡Øª Ø·Ø§Ù‚ØªÙƒ!</h1>
                <button class="btn" onclick="location.reload()">Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
            </div>
        </div>
    </div>

    <script>
        const state = {
            ammo: 0,
            currentLevel: 1,
            bossTimer: 60,
            activeIntervals: [],
            isGameOver: false
        };

        function playSound(id, loop = false) {
            const s = document.getElementById(id);
            if (s) { s.loop = loop; s.currentTime = 0; s.play().catch(()=>{}); }
        }

        function stopSound(id) {
            const s = document.getElementById(id);
            if (s) s.pause();
        }

        function switchScene(id) {
            document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        function startGame() {
            playSound('bg-music', true);
            switchScene('scene-video-intro');
            document.getElementById('vid-intro').play();
        }

        function goToStory() {
            document.getElementById('vid-intro').pause();
            switchScene('scene-story');
        }

        // ØªØ´ØºÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ù„Ù„Ù…Ø±Ø­Ù„Ø©
        function playLevelIntro(num) {
            state.currentLevel = num;
            document.getElementById('hud').style.display = 'none';
            const introVid = document.getElementById('level-intro-video');
            introVid.src = `level ${num}.mp4`;
            switchScene('scene-level-intro');
            introVid.play().catch(startActualLevel);
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„ÙØ¹Ù„ÙŠ
        function startActualLevel() {
            document.getElementById('level-intro-video').pause();
            document.getElementById('hud').style.display = 'block';
            document.getElementById('current-lvl-text').innerText = state.currentLevel;
            switchScene('scene-gameplay');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
            setTimeout(() => {
                document.getElementById('stage-announcer').style.visibility = 'hidden';
            }, 2000);

            // Ø¨Ø¯Ø¡ Ø¥Ø³Ù‚Ø§Ø· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
            const spawner = setInterval(spawnCard, 700);
            state.activeIntervals.push(spawner);

            // Ù…Ø¯Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø© 15 Ø«Ø§Ù†ÙŠØ©
            setTimeout(() => {
                clearInterval(spawner);
                document.getElementById('stage-announcer').style.visibility = 'visible';
                if(state.currentLevel < 3) {
                    playLevelIntro(state.currentLevel + 1);
                } else {
                    startBossBattle();
                }
            }, 15000);
        }

        function spawnCard() {
            const container = document.getElementById('scene-gameplay');
            if(!container.classList.contains('active')) return;

            const isBomb = Math.random() > 0.85;
            const card = document.createElement('div');
            card.className = isBomb ? 'bomb' : 'wbc';
            card.style.left = (Math.random() * 85 + 5) + 'vw';
            card.style.top = '-80px';
            card.innerHTML = isBomb ? 'ğŸ’£' : 'ğŸ›¡ï¸';
            container.appendChild(card);

            let posY = -80;
            const speed = 6 + (state.currentLevel * 1.5);
            
            const move = setInterval(() => {
                posY += speed;
                card.style.top = posY + 'px';
                if(posY > window.innerHeight) {
                    clearInterval(move);
                    card.remove();
                }
            }, 20);

            card.onmousedown = (e) => {
                e.preventDefault();
                playSound('click-sound');
                if(isBomb) {
                    state.ammo = Math.max(0, state.ammo - 10);
                } else {
                    state.ammo += 5;
                }
                document.getElementById('ammo-count').innerText = state.ammo;
                card.remove();
                clearInterval(move);
            };
            
            // Ø¯Ø¹Ù… Ø§Ù„Ù„Ù…Ø³
            card.ontouchstart = card.onmousedown;
        }

        function startBossBattle() {
            switchScene('scene-boss');
            const grid = document.getElementById('fort-grid');
            grid.innerHTML = '';
            
            // Ø¥Ù†Ø´Ø§Ø¡ 20 Ù„Ø¨Ù†Ø© Ù„Ù„Ø­ØµÙ†
            for(let i=0; i<20; i++) {
                const brick = document.createElement('div');
                brick.style = "width:70px; height:50px; background:linear-gradient(#8b0000, #4a0000); border:2px solid gold; cursor:pointer; display:flex; justify-content:center; align-items:center; border-radius:5px;";
                brick.innerHTML = "ğŸ§±";
                brick.onclick = (e) => {
                    if(state.ammo >= 2) {
                        playSound('click-sound');
                        state.ammo -= 2;
                        document.getElementById('ammo-count').innerText = state.ammo;
                        brick.style.visibility = 'hidden';
                        checkBossWin();
                    }
                };
                grid.appendChild(brick);
            }

            const timer = setInterval(() => {
                state.bossTimer--;
                document.getElementById('boss-timer').innerText = state.bossTimer;
                if(state.bossTimer <= 0) {
                    clearInterval(timer);
                    if(!state.isGameOver) gameOver();
                }
            }, 1000);
            state.activeIntervals.push(timer);
        }

        function checkBossWin() {
            const bricks = Array.from(document.getElementById('fort-grid').children);
            const visibleBricks = bricks.filter(b => b.style.visibility !== 'hidden');
            if(visibleBricks.length === 0) {
                state.isGameOver = true;
                state.activeIntervals.forEach(clearInterval);
                showFinalTruth();
            }
        }

        function showFinalTruth() {
            document.getElementById('hud').style.display = 'none';
            switchScene('scene-truth');
            setTimeout(() => {
                switchScene('scene-message');
                typeMessage();
            }, 5000);
        }

        function typeMessage() {
            const msg = "Ù…Ù† Ø§Ù„Ù‚Ù„Ø¨ Ø¥Ù„Ù‰ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø¹Ø§Ù„Ù…: Ø¹ÙØ´ØªÙ… Ø£ØµØ­Ø§Ø¡ØŒ Ù…ØªÙØ§Ø¦Ù„ÙŠÙ†ØŒ Ø¢Ù…Ù†ÙŠÙ†.. Ø£Ù†ØªÙ… Ø§Ù„Ø£Ù…Ù„.";
            const target = document.getElementById('typewriter-text');
            let i = 0;
            playSound('typing-sound', true);

            function step() {
                if(i < msg.length) {
                    target.innerHTML += msg.charAt(i);
                    i++;
                    setTimeout(step, 100);
                } else {
                    stopSound('typing-sound');
                    setTimeout(() => {
                        switchScene('scene-win-video');
                        document.getElementById('vid-win').play();
                    }, 3000);
                }
            }
            step();
        }

        function gameOver() {
            state.isGameOver = true;
            state.activeIntervals.forEach(clearInterval);
            document.getElementById('hud').style.display = 'none';
            switchScene('scene-lose');
        }
    </script>
</body>
</html>
