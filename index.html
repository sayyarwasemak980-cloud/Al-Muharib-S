<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÿßŸÑŸÖÿ≠ÿßÿ±ÿ® ÿ≥ - ÿßŸÑÿ•ÿµÿØÿßÿ± ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸä</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

        body {
            margin: 0; padding: 0; overflow: hidden;
            font-family: 'Cairo', sans-serif;
            background-color: #000; color: white;
            user-select: none; -webkit-user-select: none;
            touch-action: manipulation;
        }

        #game-container {
            position: relative; width: 100vw; height: 100vh;
            overflow: hidden; background: #000;
        }

        #hud {
            position: absolute; top: 15px; right: 15px;
            background: rgba(0, 0, 0, 0.6); padding: 10px 20px;
            border-radius: 30px; border: 1.5px solid rgba(255, 215, 0, 0.5);
            font-size: 1.2rem; z-index: 9999; display: none;
            color: #ffd700; backdrop-filter: blur(5px);
        }

        .scene {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; display: none;
            flex-direction: column; justify-content: center;
            align-items: center;
        }

        .active { display: flex; }

        .full-screen-media { 
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; object-fit: cover; 
            z-index: 1;
        }

        .btn-start {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.8); 
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 25px; font-size: 1rem;
            cursor: pointer; border-radius: 20px;
            z-index: 100; position: absolute; bottom: 15%;
            transition: all 0.3s; backdrop-filter: blur(2px);
        }

        .btn-game {
            background: rgba(255, 87, 34, 0.9); color: white; border: none;
            padding: 12px 40px; font-size: 1.4rem;
            cursor: pointer; border-radius: 50px; z-index: 100;
            box-shadow: 0 0 15px rgba(255, 87, 34, 0.5);
        }

        .falling-item {
            position: absolute; cursor: pointer; z-index: 10000;
            display: flex; justify-content: center; align-items: center;
            border-radius: 50%; touch-action: none;
            font-size: 2rem;
        }

        .wbc { width: 60px; height: 60px; background: radial-gradient(circle, #fff, #add8e6); border: 2px solid #fff; box-shadow: 0 0 15px #fff; }
        .info-card { width: 75px; height: 75px; background: radial-gradient(circle, #ffd700, #ff8c00); border: 3px solid #fff; box-shadow: 0 0 20px #ffd700; }
        .bomb { width: 65px; height: 65px; background: #000; border: 3px solid #f00; box-shadow: 0 0 15px #f00; }

        #fort-grid { display: grid; grid-template-columns: repeat(5, 65px); gap: 10px; z-index: 100; }
        .brick { width: 65px; height: 45px; background: #500; border: 1px solid gold; border-radius: 4px; cursor: pointer; }

        #typewriter-text { font-size: 1.8rem; color: #ffd700; text-align: center; max-width: 80%; z-index: 100; line-height: 1.6; }
        #skip-btn { position: absolute; bottom: 20px; left: 20px; z-index: 9999; font-size: 0.9rem; opacity: 0.7; cursor: pointer; color: #fff; }
    </style>
</head>
<body>

    <audio id="bg-music" loop><source src="sound 1.mp3" type="audio/mpeg"></audio>
    <audio id="final-sfx"><source src="sound 2.mp3" type="audio/mpeg"></audio>

    <div id="game-container">
        <div id="hud">üõ°Ô∏è ÿ∞ÿÆŸäÿ±ÿ© ÿßŸÑŸÖŸÜÿßÿπÿ© ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™Ÿäÿ©: <span id="ammo-count">0</span></div>

        <!-- ÿßŸÑÿ®ÿØÿßŸäÿ© -->
        <div id="scene-start" class="scene active">
            <img src="Ÿàÿßÿ¨Ÿáÿ©.png" class="full-screen-media">
            <button class="btn-start" onclick="startGame()">ÿßÿ®ÿØÿ£</button>
        </div>

        <!-- ŸÖŸÇÿØŸÖÿ© ÿßŸÑŸÅŸäÿØŸäŸà -->
        <div id="scene-video-intro" class="scene">
            <video id="vid-intro" class="full-screen-media" onended="goToStory()">
                <source src="First.mp4" type="video/mp4">
            </video>
        </div>

        <!-- ÿßŸÑŸÇÿµÿ© -->
        <div id="scene-story" class="scene">
            <img src="ŸÇÿµÿ© ÿßŸÑŸÖÿ≠ÿßÿ±ÿ® ÿ≥.png" class="full-screen-media">
            <button class="btn-game" style="position:absolute; bottom:10%;" onclick="playLevelTransition(1)">ÿßÿ≥ÿ™ŸÖÿ±ÿßÿ±</button>
        </div>

        <!-- ÿßŸÜÿ™ŸÇÿßŸÑ ÿßŸÑŸÖÿ±ÿßÿ≠ŸÑ (1-6) -->
        <div id="scene-level-intro" class="scene">
            <video id="level-intro-video" class="full-screen-media" onended="startPlay()"></video>
            <div id="skip-btn" onclick="startPlay()">ÿ™ÿÆÿ∑Ÿä >></div>
        </div>

        <!-- ÿßŸÑŸÑÿπÿ® -->
        <div id="scene-gameplay" class="scene">
            <video id="gameplay-bg" class="full-screen-media" autoplay muted loop style="opacity:0.4;"></video>
        </div>

        <!-- ÿßŸÑÿ≠ÿµŸÜ (ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿÆÿ™ÿßŸÖŸäÿ©) -->
        <div id="scene-boss" class="scene">
            <video class="full-screen-media" autoplay muted loop><source src="level 6.mp4" type="video/mp4"></video>
            <div id="fort-grid"></div>
        </div>

        <!-- ÿßŸÑÿ≠ŸÇŸäŸÇÿ© -->
        <div id="scene-truth" class="scene">
            <img src="ÿ≠ŸÇŸäŸÇÿ© ÿßŸÑŸÖÿ≠ÿßÿ±ÿ® ÿ≥.png" class="full-screen-media">
        </div>

        <!-- ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿÆÿ™ÿßŸÖŸäÿ© -->
        <div id="scene-message" class="scene" style="background:#000;">
            <div id="typewriter-text"></div>
        </div>

        <!-- ŸÅŸäÿØŸäŸà ÿßŸÑŸÜŸáÿßŸäÿ© -->
        <div id="scene-win" class="scene">
            <video id="vid-win" class="full-screen-media"><source src="win.mp4" type="video/mp4"></video>
        </div>
    </div>

    <script>
        const state = { ammo: 0, level: 1, intervals: [], maxLevel: 6 };

        function switchScene(id) {
            document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startGame() {
            const m = document.getElementById('bg-music');
            m.volume = 0.3;
            m.play().catch(()=>{});
            switchScene('scene-video-intro');
            document.getElementById('vid-intro').play();
        }

        function goToStory() {
            switchScene('scene-story');
        }

        function playLevelTransition(lvl) {
            state.level = lvl;
            document.getElementById('hud').style.display = 'none';
            const v = document.getElementById('level-intro-video');
            // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖŸÑŸÅÿßÿ™ ŸÖŸÜ level 1.mp4 ÿ•ŸÑŸâ level 6.mp4
            v.src = `level ${lvl}.mp4`;
            switchScene('scene-level-intro');
            v.play().catch(startPlay);
        }

        function startPlay() {
            document.getElementById('level-intro-video').pause();
            document.getElementById('hud').style.display = 'block';
            const bg = document.getElementById('gameplay-bg');
            bg.src = `level ${state.level}.mp4`;
            switchScene('scene-gameplay');

            // ÿ™ŸÜÿ∏ŸäŸÅ ÿ£Ÿä ŸÅÿ™ÿ±ÿßÿ™ ÿ≤ŸÖŸÜŸäÿ© ÿ≥ÿßÿ®ŸÇÿ©
            state.intervals.forEach(clearInterval);
            state.intervals = [];

            const spawnInt = setInterval(spawn, 900);
            state.intervals.push(spawnInt);

            // ŸÉŸÑ ŸÖÿ±ÿ≠ŸÑÿ© ÿ™ÿ≥ÿ™ÿ∫ÿ±ŸÇ 15 ÿ´ÿßŸÜŸäÿ©
            setTimeout(() => {
                clearInterval(spawnInt);
                if(state.level < state.maxLevel) {
                    playLevelTransition(state.level + 1);
                } else {
                    startBoss();
                }
            }, 15000);
        }

        function spawn() {
            const container = document.getElementById('scene-gameplay');
            if(!container.classList.contains('active')) return;

            const rand = Math.random();
            let type = 'wbc'; 
            let icon = '‚ö™';
            
            if(rand > 0.85) { type = 'bomb'; icon = 'üí£'; }
            else if(rand > 0.65) { type = 'info-card'; icon = 'üõ°Ô∏è'; }

            const el = document.createElement('div');
            el.className = `falling-item ${type}`;
            el.style.left = (Math.random() * 80 + 10) + 'vw';
            el.style.top = '-80px';
            el.innerHTML = icon;
            container.appendChild(el);

            let pos = -80;
            const speed = 3.5 + (state.level * 0.3);
            const anim = setInterval(() => {
                pos += speed;
                el.style.top = pos + 'px';
                if(pos > window.innerHeight) { clearInterval(anim); el.remove(); }
            }, 25);

            const hit = (e) => {
                e.preventDefault();
                if(type === 'wbc') state.ammo += 1; // ŸÜŸÇÿ∑ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÑŸÑŸÉÿ±Ÿäÿ©
                else if(type === 'info-card') state.ammo += 10; // 10 ŸÜŸÇÿßÿ∑ ŸÑŸÑÿ®ÿ∑ÿßŸÇÿ©
                else if(type === 'bomb') state.ammo = Math.max(0, state.ammo - 15);
                
                document.getElementById('ammo-count').innerText = state.ammo;
                clearInterval(anim);
                el.remove();
            };
            el.addEventListener('mousedown', hit);
            el.addEventListener('touchstart', hit);
        }

        function startBoss() {
            switchScene('scene-boss');
            const grid = document.getElementById('fort-grid');
            grid.innerHTML = '';
            for(let i=0; i<20; i++) {
                const b = document.createElement('div');
                b.className = 'brick';
                b.onclick = () => {
                    if(state.ammo >= 5) {
                        state.ammo -= 5;
                        document.getElementById('ammo-count').innerText = state.ammo;
                        b.style.visibility = 'hidden';
                        if(Array.from(grid.children).every(x => x.style.visibility === 'hidden')) win();
                    }
                };
                grid.appendChild(b);
            }
        }

        function win() {
            document.getElementById('hud').style.display = 'none';
            switchScene('scene-truth');
            setTimeout(() => {
                document.getElementById('bg-music').pause();
                switchScene('scene-message');
                const text = "ŸÖŸÜ ÿßŸÑŸÇŸÑÿ® ÿ•ŸÑŸâ ÿ£ÿ®ÿ∑ÿßŸÑ ÿßŸÑÿπÿßŸÑŸÖ: ÿπŸêÿ¥ÿ™ŸÖ ÿ£ÿµÿ≠ÿßÿ°ÿå ŸÖÿ™ŸÅÿßÿ¶ŸÑŸäŸÜÿå ÿ¢ŸÖŸÜŸäŸÜ.. ÿ£ŸÜÿ™ŸÖ ÿßŸÑÿ£ŸÖŸÑ.";
                const target = document.getElementById('typewriter-text');
                let i = 0;
                // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™ 2 ÿ≠ÿµÿ±ŸäÿßŸã ŸáŸÜÿß
                const finalSfx = document.getElementById('final-sfx');
                finalSfx.play().catch(()=>{});
                
                const type = setInterval(() => {
                    if(i < text.length) { 
                        target.innerHTML += text[i++]; 
                    } else {
                        clearInterval(type);
                        setTimeout(() => {
                            switchScene('scene-win');
                            document.getElementById('vid-win').play();
                        }, 3000);
                    }
                }, 100);
            }, 5000);
        }
    </script>
</body>
</html>
